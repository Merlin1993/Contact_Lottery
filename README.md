# Contact_Lottery
抽奖合约

# 抽奖流程
1.首先由开发人员，部署合约，再设定抽奖基本参数 （抽奖者名单，启动抽奖账号，启动时间，抽奖间隔时间，每轮奖池金额，剩余奖池金额）
2.由抽奖发起人在DAPP界面中启动投票。
3.参与抽奖者在DAPP中校验资格，进入抽奖。
4.每轮每人可以抽取一次，抽取完以后需要等待下一轮。未抽完的奖池会并入到下一轮。
6.第五轮时，只抽十人，所以有部分人抽奖金额会为0。 

# 随机算法
前四轮：
每个人的中奖金额范围 为 （1 - 总奖池/剩余人数*1.5倍）。也就是每个人中奖金额的期望为 0.75 * 总奖池 / 剩余人数 。

随机数 = 账户 * 区块号 * 区块时间戳。

随机数 对 10 取余 ，如果为0或1，则中奖金额范围缩小10倍；如果为10，则中奖金额范围增大4倍。

随机数 对 中奖金额范围取余 ， 得到的值即为中奖金额。

第五轮：
只抽十人，其余人抽不到奖。

随机数 = 账户 * 区块号 * 区块时间戳。

随机数 对 (总人数/中奖人数) 取余，如果为0，表示中奖。

中奖者的中奖金额范围 为 (1 - 总奖池/中奖剩余人数 * 2)。

随机数 对中奖金额范围取余，得到的值即为中奖金额。

备注：
1.如果到最后一个人，奖池仍未清空，那么最后一个人会将奖池金额全部获取。
2.为了避免某个人中大奖后，后面的人抽不到钱，所以会保留剩余人数*1的奖金。每个人最低能中1元。

# API
InitAuth  设置抽奖基本参数

入参|解释
---|:--:
auth|可以抽奖者的名单
boss|启动抽奖账号
start|启动时间
interval|抽奖间隔时间
roundPool|每轮奖池
lastRoundCount|最后一轮人数
---

Login 抽奖者登录，不登录无法进行抽奖

入参|解释
---|:--:
name|抽奖者姓名

出参|解释
---|:--:
hasAuth|是否有权限加入抽奖
---

GetAuth 获取当前账户是否可以启动，是否已经启动

出参|解释
---|:--:
boss|当前账户是否可以启动
start|是否已经启动
---

AuthVerification 获取当前账户本轮是否可以抽奖

出参|解释
---|:--:
auth|本轮是否可以抽奖
end | 是否已经第五轮完成抽奖
---

GetCountDownTime 获取下轮开启剩余时间

出参|解释
---|:--:
timeLeft|下轮剩余时间
rounds|下一轮的轮次
---

GetPrizePool() 获取奖池金额

出参|解释
---|:--:
pool|当前轮奖池数
rounds|当前为第几轮
---

GetSurpriseHistory 获取抽奖记录

出参|解释
---|:--:
History|中奖记录
---

Surprise 开始本轮抽奖

出参|解释
---|:--:
get|中奖金额
rname|中奖者姓名
ruser|中奖者账户地址
round|当前轮次
---
